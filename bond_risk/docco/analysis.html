<?xml version="1.0" encoding="ISO-8859-1"?>

  <!DOCTYPE html
            PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
            "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

     <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="stylesheet" type="text/css" href="http://trad4.sourceforge.net/gcc.css" />
<title>
Analysis: bond_risk
</title>
</head>

<body bgcolor="#FFFFFF" text="#000000" link="#1F00FF" alink="#FF0000" vlink="#9900DD">

<h1 align="center">
Analysis: bond_risk
</h1>
<table border="1">
<tr>
<td>Download version</td>
<td><a href="">TBA</a></td>
</tr>
<tr>
<td>Download licence</td>
<td>BSD</td>
</tr>
<tr>
<td>Trad4 version</td>
<td><a href="">TBA</a></td>
</tr>
<tr>
<td>Author</td>
<td>schevans</td>
</tr>
<tr>
<td>Date</td>
<td>17-05-2009</td>
</tr>
</table>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#hosts">The hosts</a></li>
<li><a href="#st_mean">Single-threaded mean (ST Mean)</a></li>
<li><a href="#br440k">Test 1: 440k objects, non-optimised</a></li>
<li><a href="#br440k_opt">Test 2: 440k objects, optimised</a></li>
<li><a href="#context">Test 3: 440k objects, time vs. context switches</a></li>
<li><a href="#context_time">Test 4: 440k objects, context switches over time</a></li>
</ul>

<hr />

<h2><a name="introduction">Introduction</a></h2>
<p>
This is an analysis of the trad4 app bond_risk. This document is still in beta - if there is anything you'd like clarified or any test you'd like to see run, please let me know.
</p>
<p>
What we'll be measuring is the duration of the initial flush on start-up under various conditions. A flush is when every node gets recalculated, as happens on start-up. As such we'll be ignoring the time it takes to load the objects from the DB (a subject for later discussion).
</p>
<p>
For each test the binary is locally compiled, and the test is run with the host in single-user mode using a non-root user and the default nice.
</p>
<p>
Unless otherwise stated, all these tests were run against the 440k data set (40k bonds, 200k each or repo and outright trades).
</p>
<p>
The tests are summarised below:
<ul>
<li>Tests 1&2 are comparisons between the Athlon and Opteron measuring the duration of the 440k flush duration against log2 threads using both optimised and non-optimised binaries.</li>
<li>Test 3 shows the 440k flush duration along with context switches</li>
<li>Test 4 shows context switches per second as a 440k flush runs against log2 threads.</li>
</ul>
</p>
<h2><a name="hosts"></a>The hosts</h2>
<p>
The hosts are summarised below.
<table border="1">
<tr><td>Host</td><td>Athlon</td><td>Opteron</td></tr>
<tr><td>Model</td><td>64 X2 Dual Core 4800+</td><td>Quad-Core Opteron 2354</td></tr>
<tr><td>CPU GHz*</td><td>2.4</td><td>2.1</td></tr>
<tr><td>Cores</td><td>2</td><td>8</td></tr>
<tr><td>Dies</td><td>1</td><td>2</td></tr>
<tr><td>OS Arch</td><td>i686</td><td>x86_64</td></tr>
<tr><td>Kernel</td><td>2.6.22-15-generic</td><td>2.6.27-7-server</td></tr>
<tr><td>Compiler</td><td>gcc 4.1.3</td><td>gcc 4.3.2</td></tr>
</table>
* As advertised
</p>
<p>
I will also be running a couple of these tests on a 3 year-old Intel which lacks a HyperTransport bus (QuickPath in Intel-speak), which should prove interesting.
</p>
<h2><a name="st_mean">Single-threaded mean (ST Mean)</a></h2>
<p>
The ST Mean value of a particular test is the mean value of 10 runs in single-threaded mode (NUM_THREADS=0). This gives us a good benchmark for the single-threaded performace of a particular arch/comiler combination.
</p>
This also gives us some information on the variance and standard deviation of these runs. This is shown in the table below:
</p>
<p>
<table border="1">
<tr><td>Test</td><td>Mean</td><td>Variance</td><td>Standard Deviation</td></tr>
<tr><td>Athlon</td><td>22.3148</td><td>0.2297</td><td>0.4792</td></tr>
<tr><td>AthlonO3</td><td>8.2094</td><td>1.3066</td><td>1.1431</td></tr>
<tr><td>Opteron</td><td>19.9114</td><td>0.2944</td><td>0.5426</td></tr>
<tr><td>OpteronO3</td><td>13.2403</td><td>0.0020</td><td>0.0450</td></tr>
</table>

</p>

<h2><a name="br440k"></a>Test 1: 440k objects, non-optimised</h2>
<p>
<table border="1">
<tr><td>Num Threads</td><td>Athlon Time</td><td>Opteron Time</td></tr>
<tr><td>1</td><td>70.05</td><td>54.82</td></tr>
<tr><td>2</td><td>35.83</td><td>24.59</td></tr>
<tr><td>4</td><td>22.13</td><td>12.12</td></tr>
<tr><td>8</td><td>15.06</td><td>6.11</td></tr>
<tr><td>16</td><td>14.15</td><td>3.51</td></tr>
<tr><td>32</td><td>13.66</td><td>2.99</td></tr>
<tr><td>64</td><td>13.3</td><td>2.73</td></tr>
<tr><td>128</td><td>13.2</td><td>2.8</td></tr>
<tr><td>256</td><td></td><td>2.74</td></tr>
<tr><td>512</td><td></td><td>2.87</td></tr>
</table>
</p>
<p>
<img src="br440k.jpg" alt="br440k"/>
</p>
<h2><a name="br440k_opt"></a>Test 2: 440k objects, optimised</h2>
<p>
<table border="1">
<tr><td>Num Cores</td><td>Athlon Time</td><td>Opteron Time</td></tr>
<tr><td>1</td><td>49.98</td><td>46.79</td></tr>
<tr><td>2</td><td>30.68</td><td>21.24</td></tr>
<tr><td>4</td><td>12.37</td><td>10.13</td></tr>
<tr><td>8</td><td>8.37</td><td>5.19</td></tr>
<tr><td>16</td><td>6.52</td><td>2.66</td></tr>
<tr><td>32</td><td>6.17</td><td>2.25</td></tr>
<tr><td>64</td><td>6.01</td><td>1.92</td></tr>
<tr><td>128</td><td>5.85</td><td>1.91</td></tr>
<tr><td>256</td><td></td><td>1.94</td></tr>
<tr><td>512</td><td></td><td>2.08</td></tr>
</table>
</p>
<p>
<img src="br440k_opt.jpg" alt="br440k_opt"/>
</p>
<h2><a name="context"></a>Test 3: 440k objects, time vs. context switches</h2>
<p>
<table border="1">
<tr><td>Num Threads</td><td>Opteron Time</td><td>Opteron CS</td></tr>
<tr><td>1</td><td>46.79</td><td>105.75</td></tr>
<tr><td>2</td><td>21.24</td><td>55.69</td></tr>
<tr><td>4</td><td>10.13</td><td>30.76</td></tr>
<tr><td>8</td><td>5.19</td><td>16.94</td></tr>
<tr><td>16</td><td>2.66</td><td>11.13</td></tr>
<tr><td>32</td><td>2.25</td><td>9.2</td></tr>
<tr><td>64</td><td>1.92</td><td>8.89</td></tr>
<tr><td>128</td><td>1.91</td><td>10.01</td></tr>
<tr><td>256</td><td>1.94</td><td>13.63</td></tr>
<tr><td>512</td><td>2.08</td><td>23.78</td></tr>
</table>
</p>
<p>
<img src="br440k_context.jpg" alt="br440k_context"/>
</p>
<h2><a name="context_time"></a>Test 4: 440k objects, context switches over time</h2>
<p>
<img src="br440k_context_time.jpg" alt="br440k_context_time"/>
</p>
<!-- ==================================================================== -->

<div align="center" class="copyright">
Copyright (c) Steve Evans 2009
</div>

<!-- ==================================================================== -->
<br />
<center>
<!--
<a href="http://sourceforge.net/projects/trad4"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=202177&type=16" width="150" height="40" border="0" alt="Get trad4 at SourceForge.net. Fast, secure and Free Open Source software downloads" /></a>
-->
</center>


</body>
</html>
